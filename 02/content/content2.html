<html xmlns="http://www.w3.org/1999/xhtml"><head><meta name="generator" content="LERSUS 3.3.0.0" /><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Корпоративные информационные системы — Теория — Логическая структура</title><script language="javascript" type="text/javascript" src="../../00/styles/files/apiwrapper.js"> </script><script language="javascript" type="text/javascript" src="../../00/styles/files/sco.js"> </script><link href="../../00/styles/files/style.css" rel="stylesheet" type="text/css" /></head><body><table id="mainOuter"><tr><td id="topOuter"><table id="topInner"><tr class="row1"><td class="cell1"><div> </div></td><td class="cell2"><div> </div></td><td class="cell3"><div> </div></td><td class="cell4" id="shortcuts"><div><ul class="level0"><li><a href="../../00/content/authors1.html">Авторы</a></li><li>|</li><li><a href="../../00/content/contacts1.html">Контакты</a></li><li>|</li><li><a href="../../00/content/instructions1.html">Методические указания</a></li><li>|</li><li><a href="../../00/content/annotation1.html">Аннотация</a></li><li>|</li><li><a href="#" onclick="history.back(); return false;">Назад</a></li></ul></div></td></tr><tr class="row2"><td class="cell1"><div> </div></td><td class="cell2"><div> </div></td><td class="cell3"><div> </div></td><td class="cell4"><div id="courseTitle">Корпоративные информационные системы</div><div id="courseSubTitle">Физическая организация БД на примере СУБД Oracle : Логическая структура</div></td></tr></table></td></tr><tr><td id="contentOuter"><table id="contentInner"><tr><td class="menuOuter"><table class="menuInner"><tr><td><ul class="level0"><li><a href="../../00/styles/courses.html">Содержание курса</a></li><li><span>Теория</span></li><ul class="level1"><li><a href="../../02/content/content1.html">Основные концепции СУБД Oracle</a></li><li><a href="../../02/content/content2.html">Логическая структура</a></li><li><a href="../../02/content/content3.html">Экстенты и сегменты</a></li><li><a href="../../02/content/content4.html">Табличные пространства и файлы данных </a></li><li><a href="../../02/content/content5.html">Процессы инстанции Oracle </a></li><li><a href="../../02/content/content6.html">Структуры памяти ORACLE</a></li><li><a href="../../02/content/content7.html">Создание таблиц с распределением памяти </a></li><li><a href="../../02/content/content8.html">Объекты базы данных</a></li><li><a href="../../02/content/content9.html">Утилита SQL*Plus</a></li><li><a href="../../02/content/content10.html">Работа со словарем данных</a></li><li><a href="../../02/content/content11.html">Введение в аудитинг</a></li></ul><li><span>Практика</span></li><ul class="level1"><li><a href="../../02/content/example1.html">Практика 1. Настройка структур памяти при создании основных объектов БД</a></li><li><a href="../../02/content/example2.html">Лабораторная работа 1. Работа с основными объектами базы и служебной информацией</a></li></ul><li><span>Текущий контроль знаний</span></li><ul class="level1"><li><a href="../../02/content/multiply-choice-test1.html">Введение в сервер Oracle</a></li><li><a href="../../02/content/multiply-choice-test9.html">Объекты схемы базы данных Oracle</a></li></ul><li><a href="../../02/styles/glossary.html">Словарь терминов</a></li><li><a href="../../02/02.pdf" target="_blank">Версия для печати</a></li></ul></td></tr></table></td><td class="content"><div id="content"><div id="topBlankStripe"> </div><span id="lnk2d89f1ecaa954416bc52902c9ee9fc11"> </span><h1 align="left" class="headline-source">     Логическая структура</h1><span id="lnkde1f38f20b0941759a079f355dc44986"> </span><h2 align="left" class="paragraph-headline-source">     Структуры логического распределения в базе данных Oracle</h2><span id="lnk6bfc49b77593490e8e979e00c7c1b134"> </span><div class="section"><p align="justify" class="paragraph-source">     Oracle распределяет пространство БД для всех ее логических единиц (таблиц, индексов и т.п.). Единицами логического распределения в Oracle являются блоки данных, экстенты и сегменты. Следующий рисунок иллюстрирует отношения между этими структурами данных.</p><p align="center" class="paragraph-source"><img src="../res/files/th1_5_0__1_.JPG" height="334px" width="558px" alt="" /><b> </b></p><p align="center" class="paragraph-source">Рисунок 1 - Отношения между сегментами, экстентами и блоками данных </p></div><span id="lnkddaed9d268074da79bb792a167059c4c"> </span><h2 align="left" class="paragraph-headline-source">     Блоки данных</h2><span id="lnk76163067ccce4e80bbd889b0770b64ac"> </span><div class="section"><p align="justify" class="paragraph-source">     На самом низком уровне рассмотрения, данные базы данных ORACLE хранятся в <i><b>блоках данных</b></i> (называемых также логическими блоками, блоками ORACLE или страницами). Один блок данных соответствует фиксированному числу байт физического пространства базы данных на диске. Размер блока данных специфически устанавливается для каждой базы данных ORACLE при ее создании. Этот размер кратен размеру блока операционной системы, но не превышает определенный максимум. Важно помнить, что база данных, на ее самом низком уровне, использует и распределяет свободное пространство в базе данных блоками данных ORACLE. </p><p align="justify" class="paragraph-source">     Все данные на физическом уровне, т.е. на уровне операционной системы, распределяются в байтах. Каждая операционная система имеет то, что называется размером блока, который определяется как специфическое число байт на диске. </p></div><span id="lnkbf34de25959f42f3be1b6d56bf44fdc1"> </span><h2 align="left" class="paragraph-headline-source">     Экстенты</h2><span id="lnk75590aa957464c8ead255e959b0f1da8"> </span><div class="section"><p align="justify" class="paragraph-source">     Следующий уровень логического пространства базы данных называется экстентом. </p><p align="justify" class="paragraph-source">     <i><b>Экстент</b></i> - это специфическое число смежных блоков данных, распределяемых для хранения специфического типа информации. </p></div><span id="lnkbc9cfffa5c1a418d8aaa8d3a91f15e6e"> </span><h2 align="left" class="paragraph-headline-source">     Сегменты</h2><span id="lnkcbd011fbbba74db983279f0d0f801437"> </span><div class="section"><p align="justify" class="paragraph-source">     Уровень логического пространства базы данных, следующий за экстентом, называется <i><b>сегментом</b></i>. </p><p align="justify" class="paragraph-source">     <i><b>Сегмент </b></i>- это совокупность экстентов, распределенных для специфического типа структуры данных, и находящихся в одном и том же табличном пространстве. Например, данные каждой таблицы хранятся в ее собственном сегменте данных, а данные каждого индекса хранятся в его собственном сегменте индекса. </p><p align="justify" class="paragraph-source">     ORACLE распределяет пространство для сегментов экстентами. Поэтому, когда существующие экстенты сегмента заполнены, ORACLE распределяет очередной экстент для этого сегмента. Поскольку экстенты распределяются при необходимости, экстенты сегмента не обязательно смежны на диске, и могут быть распределены между различными файлами. Каждый экстент, однако, не может находиться в нескольких файлах. </p></div><span id="lnk8c1937beb2904019bf69e23860ae5c43"> </span><h2 align="left" class="paragraph-headline-source">     Управление пространством</h2><span id="lnk156f47f8652e440abfcf3ceac94f4850"> </span><div class="section"><p align="justify" class="paragraph-source">     Итак, ORACLE управляет пространством в файлах данных базы данных в единицах, называемых блоками данных (наименьшими единицами ввода-вывода в базе данных). </p><p align="justify" class="paragraph-source">     Формат блока данных ORACLE один и тот же, независимо от того, содержит ли блок данные таблицы, индекса или кластера. Рис.2 иллюстрирует формат блока данных.</p></div><span id="lnk01642fd881614981bf77bfb9a0fa6b7f"> </span><div align="center"><div class="inline-table-container"><p align="left" class="unit-title">Таблица 1 - Формат блока данных</p><table class="inline-table"><col width="215" /><tbody><tr><td style="background-color:#ffffff"><p align="center" class="inline-table"><b>Блок базы данных</b></p></td></tr><tr><td style="background-color:#ffffff"><p align="center" class="inline-table">Общий и переменный заголовок </p></td></tr><tr><td style="background-color:#ffffff"><p align="center" class="inline-table">Оглавление таблиц </p></td></tr><tr><td style="background-color:#ffffff"><p align="center" class="inline-table">Оглавление строк </p></td></tr><tr><td style="background-color:#ffffff"><p align="center" class="inline-table">Свободное пространство </p></td></tr><tr><td style="background-color:#ffffff"><p align="center" class="inline-table">Данные строк </p></td></tr></tbody></table></div></div><span id="lnkd039e90fb34349079b75c4901ec4a2a4"> </span><div class="section"><p align="justify" class="paragraph-source">     <i><b>Заголовок </b></i>содержит общую информацию блока, такую как адрес блока и тип сегмента (сегмент данных, сегмент индекса или сегмент отката). Заголовок составляет накладные расходы блока, которые имеют переменный размер. В среднем, суммарные накладные расходы фиксированной и переменной частей блока составляют от 84 до 107 байт. </p><p align="justify" class="paragraph-source">     Часть блока, составляющая <i>оглавление таблиц</i>, содержит информацию о том, какие таблицы имеют строки в этом блоке. </p><p align="justify" class="paragraph-source">     <i><b>Оглавление строк</b></i><i> </i>- эта часть блока содержит информацию о действительных строках в блоке (включая адреса каждой порции строки в области данных строк). После того, как в оглавлении строк распределено пространство, это пространство не освобождается при удалении строки. Поэтому блок, который сейчас пуст, но когда-то содержал до 50 строк, по-прежнему имеет 100 байт, распределенных в заголовке для оглавления строк. Это пространство используется повторно лишь тогда, когда в блок вставляются новые строки. </p><p align="justify" class="paragraph-source">     <i><b>Данные строк</b></i><i> </i>- эта порция блока содержит данные таблицы или индекса. Строки могут переходить из блока в блок. </p><p align="justify" class="paragraph-source">     Свободное пространство в блоке используется для вставки новых строк и для обновлений строк, требующих дополнительного пространства (например, при замене пустых хвостовых значений на непустые значения). Будут ли конкретные вставки действительно осуществляться в данном блоке - зависит от значения параметра управления пространством PCTFREE и от текущей величины свободного пространства в блоке. </p></div><span id="lnk6adfc55ecf5a4a0ba5344c04aa1a5035"> </span><h2 align="left" class="paragraph-headline-source">     Введение в PCTFREE, PCTUSED и цепочки строк </h2><span id="lnk28492341a7cb4f1c86f2c1dbdff56b35"> </span><div class="section"><p align="justify" class="paragraph-source">     Два параметра управления пространством, PCTFREE и PCTUSED, позволяют разработчику управлять использованием свободного пространства для вставок и обновлений строк в блоках данных. Оба этих параметра могут быть специфицированы лишь при создании (CREATE) или изменении (ALTER) таблиц и кластеров (сегментов данных). Кроме того, параметр PCTFREE можно также специфицировать при создании или изменении индексов (сегментов индекса). </p></div><span id="lnk7dc53a2578f2481fa913d001239a1ece"> </span><h2 align="left" class="paragraph-headline-source">     Параметр PCTFREE </h2><span id="lnk7b8b90c3a41341a4b8f82e84ac2c9078"> </span><div class="section"><p align="left" class="paragraph-source">     Параметр PCTFREE устанавливает процент памяти блока, резервируемой (оставляемой свободной) для возможных обновлений строк, уже содержащихся в блоке. </p></div><span id="lnk3c447e66a8ad416f82164b26a3ab1952"> </span><table class="note"><tr><td><p align="left" class="note-source">     Например, предположим, что вы специфицировали следующий параметр в предложении      CREATE TABLE:  PCTFREE 20      </p><p align="left" class="note-source">     Это требует, чтобы 20% места в каждом блоке данных в сегменте данных этой таблицы оставлялись свободными и доступными для возможных обновлений строк, уже существующих в каждом блоке (см. рис. 2). </p></td><th><img src="../../00/styles/files/note_excurs.png" title="" alt="" /></th></tr></table><span id="lnk28b2aa191d904645b1254286218243ab"> </span><div class="section"><p align="left" class="paragraph-source"></p><p align="center" class="paragraph-source">     <img src="../res/files/th1_6_0__1_.JPG" height="257px" width="410px" alt="" /> </p><p align="center" class="paragraph-source">Рисунок 2 - Структура блока с параметром PCTFREE </p><p align="center" class="paragraph-source">     </p><p align="justify" class="paragraph-source">     До того, как будет достигнут процент PCTFREE, свободное пространство в блоке данных заполняется как вставками новых строк, так и ростом заголовка блока данных. </p></div><span id="lnk8ad74e99cd3047b6951e240c67c1603d"> </span><h2 align="left" class="paragraph-headline-source">     Параметр PCTUSED</h2><span id="lnk5365d647fc394e3e8c38bc660d7d51e0"> </span><div class="section"><p align="justify" class="paragraph-source">     После того, как блок данных будет заполнен до процента PCTFREE, этот блок не рассматривается для вставки новых строк до тех пор, пока процент используемой памяти в блоке не упадет ниже параметра PCTUSED (рис.3). До этого момента свободная память в блоке может использоваться лишь для обновления строк, уже содержащихся в блоке данных. </p></div><span id="lnk0303d4ca1e9c4eab91989bbb60f0d2d9"> </span><table class="note"><tr><td><p align="justify" class="note-source">     Например, предположим, что вы специфицировали следующий параметр в предложении СREATE TABLE:  PCTUSED = 40      </p><p align="justify" class="note-source">     В этом случае, блок данных в сегменте данных, после заполнения его до отметки PCTFREE, не будет рассматриваться для вставки новых строк до тех пор, пока процент используемой памяти в блоке не упадет до 39% или ниже. </p></td><th><img src="../../00/styles/files/note_excurs.png" title="" alt="" /></th></tr></table><span id="lnk8a0a553cfd544c5aa2c4d5821828c2fa"> </span><div class="section"><p align="left" class="paragraph-source">     </p><p align="center" class="paragraph-source"><img src="../res/files/th1_7_0__1_.JPG" height="265px" width="306px" alt="" /><b> </b></p><p align="center" class="paragraph-source">Рисунок 3 - Структура блока с параметром PCTUSED </p><p align="center" class="paragraph-source"></p><p align="justify" class="paragraph-source">     PCTFREE и PCTUSED работают вместе, чтобы оптимизировать использование пространства в блоках данных экстентов внутри сегмента данных. </p><p align="justify" class="paragraph-source">     Во вновь распределенном блоке данных, место, доступное для вставок, равно размеру блока минус сумма накладных расходов (заголовок блока) и PCTFREE. Обновление существующих данных может использовать все свободное пространство в блоке; поэтому обновления могут сделать свободное место в блоке меньшим чем PCTFREE, - пространство, резервируемое для обновлений, но недоступное для вставок. </p><p align="justify" class="paragraph-source">     Для каждого сегмента данных и сегмента индекса ORACLE поддерживает один или несколько СВОБОДНЫХ СПИСКОВ; свободный список - это список блоков данных, которые были распределены для экстентов этого сегмента и имеют процент свободной памяти, превышающий PCTFREE; эти блоки доступны для вставок. </p><p align="justify" class="paragraph-source">     Когда выдается предложение INSERT, ORACLE ищет в свободном списке таблицы первый доступный блок и использует его, если можно; если свободного пространства в этом блоке слишком мало, чтобы удовлетворить требованиям этого INSERT, и по меньшей мере равно PCTUSED, то этот блок выбрасывается из свободного списка. Несколько свободных списков на сегмент могут уменьшить соперничество за свободные списки, когда имеют место одновременные вставки. </p><p align="justify" class="paragraph-source">     Когда выдаются предложения DELETE и UPDATE, ORACLE проверяет, не стало ли место, используемое в блоке, меньше чем PCTUSED; если это так, то блок передвигается в начало свободного списка, и будет первым используемым из доступных блоков. </p><p align="justify" class="paragraph-source">     Два типа предложений освобождают пространство в одном или нескольких блоках данных: предложения DELETE и те предложения UPDATE, которые заменяют существующие значения на меньшие. Память, освобожденная в результате этих типов предложений, доступна для последующих предложений INSERT. </p><p align="justify" class="paragraph-source">     Освобождаемое пространство не обязательно будет смежным с основной областью свободного пространства в блоке. Свободное пространство в блоке объединяется ("сжимается") только тогда, когда предложение UPDATE или INSERT пытается использовать блок, содержащий достаточно свободного места, для размещения нового куска строки, но фрагментация свободной памяти не позволяет вставить этот кусок строки в непрерывный участок блока. Таким образом, производительность базы данных не страдает от непрерывных и излишних сжатий свободной памяти блоков по каждой операции DELETE или UPDATE. </p><p align="justify" class="paragraph-source">     В некоторых обстоятельствах все данные строки таблицы могут не умещаться в один блок данных. В таком случае данные этой строки сохраняются в ЦЕПОЧКЕ блоков данных, резервируемых в этом сегменте. Цепочки строк возникают чаще всего при больших строках (т.е. строках, содержащих столбец с типом данных LONG или LONG RAW). Такого типа цепочек блоков избежать невозможно. Если строка в блоке данных обновляется так, что общая длина строки увеличивается, а свободное пространство в блоке заполнено, то данные всей строки МИГРИРУЮТ, т.е. переносятся в новый блок данных, при условии, что в новом блоке поместится вся строка. На месте первоначального куска мигрировавшей строки записывается указатель на новый блок, содержащий мигрировавшую строку; ROWID (указатель на строку) мигрировавшей строки не изменяется. Когда строка занимает цепочку блоков или мигрирует, производительность операций ввода-вывода, связанных с этой строкой, падает, потому что ORACLE вынужден просматривать больше одного блока данных, чтобы извлечь информацию строки. </p></div></div></td></tr></table></td></tr><tr><td id="bottomOuter"><table id="bottomInner"><tr><td class="cell1"><div> </div></td><td class="cell2"><div>© 2012 ХНУРЭ, ПИ, Широкопетлева М.С., <a href="mailto:mshirokopetleva@gmail.com">mshirokopetleva@gmail.com</a>;   ХНУРЭ, ПИ, Черепанова Ю.Ю.;   ХНУРЭ, ПИ, Мазурова О.А.<br /><a href="http://lersus.de/" title="Данный курс создан с помощью авторской системы LERSUS" target="_blank">Разработано с помощью LERSUS</a></div></td></tr></table></td></tr></table></body></html>