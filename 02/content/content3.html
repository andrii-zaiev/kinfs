<html xmlns="http://www.w3.org/1999/xhtml"><head><meta name="generator" content="LERSUS 3.3.0.0" /><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Корпоративные информационные системы — Теория — Экстенты и сегменты</title><script language="javascript" type="text/javascript" src="../../00/styles/files/apiwrapper.js"> </script><script language="javascript" type="text/javascript" src="../../00/styles/files/sco.js"> </script><link href="../../00/styles/files/style.css" rel="stylesheet" type="text/css" /></head><body><table id="mainOuter"><tr><td id="topOuter"><table id="topInner"><tr class="row1"><td class="cell1"><div> </div></td><td class="cell2"><div> </div></td><td class="cell3"><div> </div></td><td class="cell4" id="shortcuts"><div><ul class="level0"><li><a href="../../00/content/authors1.html">Авторы</a></li><li>|</li><li><a href="../../00/content/contacts1.html">Контакты</a></li><li>|</li><li><a href="../../00/content/instructions1.html">Методические указания</a></li><li>|</li><li><a href="../../00/content/annotation1.html">Аннотация</a></li><li>|</li><li><a href="#" onclick="history.back(); return false;">Назад</a></li></ul></div></td></tr><tr class="row2"><td class="cell1"><div> </div></td><td class="cell2"><div> </div></td><td class="cell3"><div> </div></td><td class="cell4"><div id="courseTitle">Корпоративные информационные системы</div><div id="courseSubTitle">Физическая организация БД на примере СУБД Oracle : Экстенты и сегменты</div></td></tr></table></td></tr><tr><td id="contentOuter"><table id="contentInner"><tr><td class="menuOuter"><table class="menuInner"><tr><td><ul class="level0"><li><a href="../../00/styles/courses.html">Содержание курса</a></li><li><span>Теория</span></li><ul class="level1"><li><a href="../../02/content/content1.html">Основные концепции СУБД Oracle</a></li><li><a href="../../02/content/content2.html">Логическая структура</a></li><li><a href="../../02/content/content3.html">Экстенты и сегменты</a></li><li><a href="../../02/content/content4.html">Табличные пространства и файлы данных </a></li><li><a href="../../02/content/content5.html">Процессы инстанции Oracle </a></li><li><a href="../../02/content/content6.html">Структуры памяти ORACLE</a></li><li><a href="../../02/content/content7.html">Создание таблиц с распределением памяти </a></li><li><a href="../../02/content/content8.html">Объекты базы данных</a></li><li><a href="../../02/content/content9.html">Утилита SQL*Plus</a></li><li><a href="../../02/content/content10.html">Работа со словарем данных</a></li><li><a href="../../02/content/content11.html">Введение в аудитинг</a></li></ul><li><span>Практика</span></li><ul class="level1"><li><a href="../../02/content/example1.html">Практика 1. Настройка структур памяти при создании основных объектов БД</a></li><li><a href="../../02/content/example2.html">Лабораторная работа 1. Работа с основными объектами базы и служебной информацией</a></li></ul><li><span>Текущий контроль знаний</span></li><ul class="level1"><li><a href="../../02/content/multiply-choice-test1.html">Введение в сервер Oracle</a></li><li><a href="../../02/content/multiply-choice-test9.html">Объекты схемы базы данных Oracle</a></li></ul><li><a href="../../02/styles/glossary.html">Словарь терминов</a></li><li><a href="../../02/02.pdf" target="_blank">Версия для печати</a></li></ul></td></tr></table></td><td class="content"><div id="content"><div id="topBlankStripe"> </div><span id="lnka10c477ab83442499c40768732c442ab"> </span><h1 align="left" class="headline-source">     Экстенты и сегменты</h1><span id="lnk1ba8ed265ca942d58d164fb235b71ac4"> </span><h2 align="left" class="paragraph-headline-source">     Экстенты</h2><span id="lnkf59a66e423fe4b16a3ac24f8ade688e4"> </span><div class="section"><p align="justify" class="paragraph-source">     <i><b>Экстент </b></i>- это логическая единица распределения пространства базы данных, состоящая из определенного числа непрерывных блоков данных. Каждый тип сегмента состоит из одного или нескольких экстентов. Когда существующее пространство в сегменте полностью использовано, ORACLE распределяет для сегмента новый экстент. </p><p align="justify" class="paragraph-source">     Независимо от типа, каждый сегмент в базе данных создается по меньшей мере с одним экстентом для хранения его данных. Этот экстент называется начальным экстентом данного сегмента. (Сегменты отката представляют исключение из этого правила; они всегда имеют как минимум два экстента.) </p><p align="justify" class="paragraph-source">     Например, при создании таблицы ее сегмент данных содержит <i><b>начальный экстент </b></i>из заданного числа блоков данных. Хотя ни одной строки еще не вставлено, блоки данных ORACLE, занимаемые начальным экстентом, уже зарезервированы для строк этой таблицы. </p><p align="justify" class="paragraph-source">     Когда блоки данных в начальном экстенте сегмента заполнятся и потребуется дополнительное пространство для новых данных, ORACLE автоматически распределяет инкрементальный экстент для этого сегмента. </p><p align="justify" class="paragraph-source">     <i><b>Инкрементальный экстент </b></i>- это очередной экстент, размер которого совпадает с размером предыдущего экстента для данного сегмента или превышает его на определенную величину (инкремент). Для целей сопровождения, каждый сегмент в базе данных содержит заголовок сегмента, который описывает характеристики этого сегмента и оглавление (список) экстентов в этом сегменте. </p><p align="justify" class="paragraph-source">     ORACLE управляет действительным распределением экстентов для данного сегмента. При распределении нового экстента для сегмента выполняются следующие шаги: </p><p align="justify" class="paragraph-source">     Шаг 1. ORACLE отыскивает (в табличном пространстве, содержащем сегмент) первый свободный, непрерывный участок блоков данных, составляющих размер инкрементального сегмента (или больше). </p><p align="justify" class="paragraph-source">     Свободное пространство для нового экстента отыскивается с помощью следующего алгоритма: </p><p align="justify" class="paragraph-source">     a) ORACLE ищет непрерывный набор блоков данных, совпадающий с размером нового экстента, предварительно округленным вверх для уменьшения внутренней фрагментации. </p><p align="justify" class="paragraph-source">     <i>Например, если новый экстент требует 19 блоков данных, ORACLE ищет ровно 20 непрерывных блоков данных. </i></p><p align="justify" class="paragraph-source">     б) Если точное совпадение не найдено, ORACLE ищет множество непрерывных блоков данных, размером не меньшее требуемого размера. Если ORACLE находит группу непрерывных блоков, минимум на пять блоков большую, чем требуемый размер экстента, то он расщепляет эту группу блоков на отдельные экстенты, один из которых имеет требуемый размер; если размер такой группы превышает требуемый размер меньше, чем на пять блоков, то новому экстенту распределяется вся эта группа блоков. </p><p align="justify" class="paragraph-source">     Продолжая наш пример, если ORACLE не находит группу ровно из 20 непрерывных блоков данных, он начинает искать множество непрерывных блоков данных числом больше 20. Если первая найденная группа содержит 25 или более блоков, ORACLE разбивает эти блоки, выделяя из них новый экстент; если первая найденная группа содержит от 21 до 24 блоков, новому экстенту распределяются все эти блоки. </p><p align="justify" class="paragraph-source">     в) Если больший набор непрерывных блоков не найден, ORACLE соединяет все свободные смежные блоки данных в соответствующем табличном пространстве, так что формируются группы непрерывных блоков большего размера. После соединения блоков данных в табличном пространстве этапы поиска (a) и (б) повторяются второй раз. </p><p align="justify" class="paragraph-source">     Если экстент не может быть распределен и после вторичного поиска, возвращается ошибка. </p><p align="justify" class="paragraph-source">     Шаг 2. После того, как ORACLE находит необходимое свободное место в табличном пространстве, часть этого свободного места, соответствующая размеру инкрементального экстента, распределяется этому экстенту. Если ORACLE нашел участок свободного пространства большего размера, чем требуется для экстента, то остаток оставляется как свободное пространство (но не меньше, чем пять непрерывных блоков). </p><p align="justify" class="paragraph-source">     Шаг 3. Заголовок сегмента и словарь данных обновляются, чтобы показать, что новый сегмент распределен, и что распределенное пространство больше не свободно. Обычно ORACLE обнуляет блоки вновь распределенного экстента при первом использовании этого экстента; в некоторых случаях ORACLE обнуляет блоки экстента в момент распределения этого экстента. </p></div><span id="lnk318d2f2eac6242e3ae208a62319d86bb"> </span><div class="section"><p align="left" class="paragraph-source">     <b>Когда освобождаются экстенты </b></p></div><span id="lnkd1181bc372664dd9a280d5d4b3c2aa7c"> </span><div class="section"><p align="justify" class="paragraph-source">     В общем случае, экстенты сегмента не возвращаются в табличное пространство, пока сегмент не освобождается как единица, как, например, при удалении таблицы предложением DROP TABLE. </p><p align="justify" class="paragraph-source">     Все экстенты, распределенные сегменту индекса, остаются распределенными, пока существует индекс. Когда индекс или ассоциированная таблица (или кластер) удаляется, его экстенты освобождаются для табличного пространства. </p><p align="justify" class="paragraph-source">     Также, ORACLE периодически проверяет, не выросли ли сегменты отката в базе данных больше их оптимального размера. Если сегмент отката имеет размер больше оптимального (т.е. имеет слишком много экстентов), то ORACLE автоматически освобождает один или несколько экстентов из этого сегмента отката. </p><p align="justify" class="paragraph-source">     Кроме того, когда заканчивается выполнение предложения, требовавшего временного сегмента, этот временный сегмент автоматически удаляется, а его экстенты возвращаются в табличное пространство, в котором был создан сегмент. </p></div><span id="lnk58406f4fe3f64623a1fbb8e51f793cc5"> </span><div class="section"><p align="left" class="paragraph-source">     <b>Определение размеров и лимитов для экстентов сегментов </b></p></div><span id="lnk21e537c771de44d58618dc35109530a7"> </span><div class="section"><p align="justify" class="paragraph-source">     Каждый сегмент определяется несколькими ПАРАМЕТРАМИ ПРОСТРАНСТВА, выражаемыми в терминах экстентов. Параметры пространства применяются ко всем типам сегментов. Они контролируют, как СУБД распределяет свободное пространство базы данных для данного сегмента. </p><p align="justify" class="paragraph-source">     Например, специфицируя параметры пространства в фразе STORAGE предложения CREATE TABLE при создании таблицы, вы можете определить, сколько памяти будет первоначально зарезервировано для сегмента данных таблицы, или лимитировать максимальный объем пространства (число экстентов), которое может быть распределено для таблицы. </p></div><span id="lnk2e3eb614871e4a41b00a1ed4cd375552"> </span><h2 align="left" class="paragraph-headline-source">     Сегменты </h2><span id="lnka91c498f81cd4fbc881648bb3dd2d7e4"> </span><div class="section"><p align="justify" class="paragraph-source">     <i><b>Сегмент </b></i>- это набор экстентов, содержащих все данные для конкретного типа структуры логического пространства внутри табличного пространства. </p><p align="justify" class="paragraph-source">     Например, для каждой таблицы ORACLE распределяет один или несколько экстентов, чтобы сформировать сегмент данных этой таблицы; для каждого индекса ORACLE распределяет один или несколько экстентов, чтобы сформировать сегмент индекса для этого индекса. </p><p align="justify" class="paragraph-source">     База данных ORACLE может содержать четыре различных типа сегментов: </p><p align="justify" class="paragraph-source">     - сегмент данных; </p><p align="justify" class="paragraph-source">     - сегмент индекса; </p><p align="justify" class="paragraph-source">     - сегмент отката; </p><p align="justify" class="paragraph-source">     - временный сегмент. </p></div><span id="lnke41395f895d74b02b2d50bb76038984c"> </span><div class="section"><p align="left" class="paragraph-source">     <b>Сегмент данных</b></p></div><span id="lnk8044a5fca52f4d3ea6f5c5a39a39f85d"> </span><div class="section"><p align="justify" class="paragraph-source">     Каждая некластеризованная таблица (в том числе снимок и журнал снимков) в базе данных ORACLE имеет единственный сегмент данных, содержащий все данные этой таблицы. Этот сегмент данных косвенно создается командой CREATE TABLE. Параметры пространства для таблицы, снимка, журнала снимков или кластера определяют способ распределения экстентов для сегмента данных. Непосредственное указание этих параметров через команды CREATE TABLE /SNAPSHOT /SNAPSHOT LOG /CLUSTER или ALTER TABLE /SNAPSHOT /SNAPSHOT LOG /CLUSTER влияет на эффективность хранения и извлечения данных в этом сегменте данных</p></div><span id="lnk3ec5c202022a47f9bfc5c88f575a25b8"> </span><div class="section"><p align="left" class="paragraph-source">     <b>Сегмент индекс</b></p></div><span id="lnk8694e9938fee42db86f07621791e084c"> </span><div class="section"><p align="justify" class="paragraph-source">     Каждый индекс в базе данных ORACLE имеет единственный сегмент индекса, содержащий все данные этого индекса. Этот сегмент косвенно создается командой CREATE INDEX. Эта команда позволяет вам специфицировать параметры пространства для экстентов сегмента индекса, а также табличное пространство, в котором должен быть создан этот сегмент индекса. (Сегмент данных для таблицы и сегмент индекса для ассоциированного индекса не обязаны размещаться в одном и том же табличном пространстве.) Создатель индекса может управлять способом распределения экстентов для сегмента индекса; непосредственное указание параметров пространства влияет на эффективность хранения и извлечения данных в этом сегменте индекса.</p></div><span id="lnk1a6d2214b0ba4375a4d44eecc205523f"> </span><div class="section"><p align="left" class="paragraph-source">     <b>Сегменты</b><b> </b><b>отката</b></p></div><span id="lnk10d577309ccb4aff887daa52180c610b"> </span><div class="section"><p align="justify" class="paragraph-source">     Каждая база данных содержит один или несколько сегментов отката. </p><p align="justify" class="paragraph-source">     <i><b>Сегмент отката</b></i> - это часть базы данных, в которой записываются действия транзакций, которые, возможно, придется отменить в некоторых обстоятельствах. Сегменты отката используются для обеспечения согласованности по чтению, для отката транзакций и для восстановления базы данных. </p><p align="justify" class="paragraph-source">     Информация в сегменте отката состоит из нескольких записей отката. Среди прочего, запись отката включает информацию блока (имя файла и ID блока, соответствующего измененным данным) и данные в том виде, какими они были перед действием транзакции. Записи отката для одной и той же транзакции связаны друг с другом, что позволяет легко найти эти записи при необходимости осуществить откат транзакции. К сегментам отката не могут обращаться ни пользователи, ни администратор базы данных; их пишет и читает только ORACLE. </p></div><span id="lnk8e504f0ac6ba4540b3f64d07b8206cd2"> </span><div class="section"><p align="left" class="paragraph-source">     <b>Сегмент отката SYSTEM</b></p></div><span id="lnk632fb2d7860f4020a3418c1beaea8fc6"> </span><div class="section"><p align="justify" class="paragraph-source">     Начальный сегмент отката SYSTEM создается при создании базы данных. Этот начальный сегмент создается в табличном пространстве SYSTEM и использует умалчиваемые параметры, ассоциированные с этим табличным пространством. Сегмент отката SYSTEM не может быть удален. Oracle всегда получает сегмент отката SYSTEM в дополнение ко всем остальным необходимым ей сегментам отката. Если в наличии есть несколько сегментов отката, ORACLE пытается использовать сегмент отката SYSTEM лишь для специальных системных транзакций, и распределяет пользовательские транзакции среди других сегментов отката; если таких транзакций слишком много, то при необходимости используется и сегмент SYSTEM. В общем случае, после создания базы данных, в табличном пространстве SYSTEM должен быть создан по меньшей мере один дополнительный сегмент отката.</p></div><span id="lnke310b5b7917845b08535ff7cf482c5c3"> </span><div class="section"><p align="left" class="paragraph-source">     <b>Состояния сегмента отката </b></p></div><span id="lnk6b0e0c78127445039474d5dcc9ee06b0"> </span><div class="section"><p align="justify" class="paragraph-source">     Сегмент отката всегда находится в одном из нескольких состояний: офлайн, получен инстанцией, участвует в неподтвержденной транзакции, нуждается в восстановлении либо удален. Состояние сегмента отката определяет, может ли он использоваться в транзакциях, и какие административные процедуры администратор может выполнять на этом сегменте. Сегмент отката может иметь следующие состояния: </p><p align="justify" class="paragraph-source">     - <b>OFFLINE</b> не был получен ни одной инстанцией;</p><p align="justify" class="paragraph-source">      - <b>ONLINE </b>был получен (переведен в онлайн) инстанцией; может содержать данные от активных транзакций;</p><p align="justify" class="paragraph-source">     - <b>NEEDS RECOVERY </b>- содержит данные от неподтвержденных транзакций, которые не могут быть отменены (из-за того, что соответствующие файлы данных недоступны);</p><p align="justify" class="paragraph-source">     - запорчен<i><b> </b></i><b>PARTLY AVAILABLE </b>- содержит данные от сомнительной распределенной транзакции;</p><p align="justify" class="paragraph-source">     - <b>INVALID </b>- был удален (пространство, которое было распределено этому сегменту отката, будет позднее занято при создании нового сегмента отката).</p></div><span id="lnka1d95b86389d433aaa255b57752ee96d"> </span><div class="section"><p align="justify" class="paragraph-source">     Состояния PARTLY AVAILABLE (частично доступен) и NEEDS RECOVERY (требует восстановления) очень похожи: и в том, и в другом состоянии сегмент отката обычно содержит данные от незаконченной транзакции. </p><p align="justify" class="paragraph-source">     Различия между этими двумя состояниями следующие: </p><p align="justify" class="paragraph-source">     - Сегмент отката PARTLY AVAILABLE используется сомнительной распределенной транзакцией, которая не может быть разрешена из-за сетевого сбоя. Сегмент отката NEEDS RECOVERY используется транзакцией (локальной или распределенной), которая не может быть разрешена из-за локального сбоя носителя, например, отсутствующего или запорченного файла данных, или запорчен сам этот сегмент. </p><p align="justify" class="paragraph-source">     - ORACLE или АБД может перевести сегмент PARTLY AVAILABLE в состояние ONLINE. Напротив, сегмент NEEDS RECOVERY должен быть переведен сначала в OFFLINE, прежде чем может быть переведен в ONLINE. (Когда база данных восстанавливается и тем самым разрешает транзакцию, ОRACLE автоматически изменяет состояние сегмента отката NEEDS RECOVERY на OFFLINE.) </p><p align="justify" class="paragraph-source">     - АБД может удалить (DROP) сегмент NEEDS RECOVERY. (Это позволяет администратору удалять запорченные сегменты.) Сегмент PARTLY AVAILABLE не может быть удален; сначала должна быть разрешена сомнительная транзакция, - либо автоматически, процессом RECO, либо вручную администратором. </p><p align="justify" class="paragraph-source">     После перевода сегмента отката PARTLY AVAILABLE в состояние ONLINE (администратором или во время запуска инстанции) ORACLE может использовать его для новых транзакций. </p><p align="justify" class="paragraph-source">     Кроме того, пока сомнительная транзакция не разрешена, она продолжает удерживать в сегменте отката занятые ей экстенты, не позволяя другим транзакциям использовать их; поэтому сегменту отката может потребоваться получение новых экстентов для активных транзакций, и он будет расти. Чтобы предотвратить рост сегмента отката, АБД может предпочесть создать новый сегмент отката для транзакций, пока не будет разрешена сомнительная транзакция, вместо того чтобы переводить сегмент PARTLY AVAILABLE в состояние ONLINE. Просмотр состояний сегментов отката Таблица словаря данных DBA_ROLLBACK_SEGS перечисляет состояния всех сегментов отката, наряду с другой информацией об этих сегментах. </p><p align="justify" class="paragraph-source">     Когда табличное пространство переводится в офлайн, так что невожможно осуществить немедленный откат транзакций, ORACLE создает ОТСРОЧЕННЫЙ СЕГМЕНТ ОТКАТА. Этот сегмент содержит записи отката, которые не могут быть применены к табличному пространству и должны ждать, пока табличное пространство не будет снова переведено в онлайн. Такие сегменты отката исчезают после того, как табличные пространства будут переведены в онлайн и восстановлены. Отсроченные сегменты отката автоматически создаются в табличном пространстве SYSTEM. </p></div><span id="lnkd976d1c91a8c45829d4e401b5657104b"> </span><div class="section"><p align="left" class="paragraph-source">     <b>Временные сегменты</b></p></div><span id="lnk83f5f718e68a428c8fbf9ef8e726fbc0"> </span><div class="section"><p align="justify" class="paragraph-source">     При обработке запросов ORACLE часто требует временного рабочего пространства для промежуточных этапов обработки предложения SQL. Это дисковое пространство, называемое <i><b>временным сегментом</b></i>, распределяется автоматически. Обычно временный сегмент нужен как рабочая область для сортировки. Сегмент не создается, если операция сортировки может быть выполнена в памяти, или если ORACLE находит какой-нибудь иной способ выполнения операции с использованием индексов. </p><p align="justify" class="paragraph-source">     Следующие предложения SQL могут потребовать использования временного сегмента:</p><p align="justify" class="paragraph-source">     - CREATE INDEX;</p><p align="justify" class="paragraph-source">     - SELECT ... ORDER BY ;</p><p align="justify" class="paragraph-source">     - SELECT DISTINCT ... ;</p><p align="justify" class="paragraph-source">     - SELECT ... GROUP BY ;</p><p align="justify" class="paragraph-source">     - SELECT ... UNION ;</p><p align="justify" class="paragraph-source">     - SELECT ... INTERSECT ;</p><p align="justify" class="paragraph-source">     - SELECT ... MINUS ;</p><p align="justify" class="paragraph-source">     - неиндексированные соединения ;</p><p align="justify" class="paragraph-source">     -некоторые коррелированные подзапросы ;</p><p align="justify" class="paragraph-source">     Например, если запрос содержит фразу DISTINCT, фразу GROUP BY и фразу ORDER BY, то может потребоваться целых два временных сегмента. Если приложения часто выдают предложения, приведенные в показанном списке, то администратору базы данных следует настроить параметр инициализации SORT_AREA_SIZE. </p><p align="justify" class="paragraph-source">     Временные сегменты распределяются при необходимости во время сессии пользователя. Например, пользователь может выдать запрос, требующий распределения трех временных сегментов. Временные сегменты удаляются, когда предложение завершает выполнение. Характеристики пространства для экстентов временного сегмента определяются умолчаниями того табличного пространства, в котором создается этот временный сегмент. Временные сегменты создаются во временном табличном пространстве пользователя, выдавшего предложение, как специфицрованого для этого пользователя опцией TEMPORARY TABLESPACE в командах CREATE USER или ALTER USER. Если для пользователя не было явно специфицировано временное табличное пространство, то для него используется пространство SYSTEM. </p><p align="justify" class="paragraph-source">     Поскольку распределение и освобождение временных сегментов происходит часто, есть резон в том, чтобы создать специальное табличное пространство для временных сегментов. Таким путем вы можете распределить дисковые операции по различным устройствам и избежать фрагментации SYSTEM и других табличных пространств, которые в противном случае использовались бы для временных сегментов. Журнал повторения не содержит никаких записей для изменений, осуществляемых во временных сегментах. </p></div></div></td></tr></table></td></tr><tr><td id="bottomOuter"><table id="bottomInner"><tr><td class="cell1"><div> </div></td><td class="cell2"><div>© 2012 ХНУРЭ, ПИ, Широкопетлева М.С., <a href="mailto:mshirokopetleva@gmail.com">mshirokopetleva@gmail.com</a>;   ХНУРЭ, ПИ, Черепанова Ю.Ю.;   ХНУРЭ, ПИ, Мазурова О.А.<br /><a href="http://lersus.de/" title="Данный курс создан с помощью авторской системы LERSUS" target="_blank">Разработано с помощью LERSUS</a></div></td></tr></table></td></tr></table></body></html>