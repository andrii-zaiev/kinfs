<html xmlns="http://www.w3.org/1999/xhtml"><head><meta name="generator" content="LERSUS 3.3.0.0" /><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Корпоративные информационные системы — Практика — Практика 2. Использование подпрограмм в языках  программирования 4-го поколения</title><script language="javascript" type="text/javascript" src="../../00/styles/files/apiwrapper.js"> </script><script language="javascript" type="text/javascript" src="../../00/styles/files/sco.js"> </script><link href="../../00/styles/files/style.css" rel="stylesheet" type="text/css" /></head><body><table id="mainOuter"><tr><td id="topOuter"><table id="topInner"><tr class="row1"><td class="cell1"><div> </div></td><td class="cell2"><div> </div></td><td class="cell3"><div> </div></td><td class="cell4" id="shortcuts"><div><ul class="level0"><li><a href="../../00/content/authors1.html">Авторы</a></li><li>|</li><li><a href="../../00/content/contacts1.html">Контакты</a></li><li>|</li><li><a href="../../00/content/instructions1.html">Методические указания</a></li><li>|</li><li><a href="../../00/content/annotation1.html">Аннотация</a></li><li>|</li><li><a href="#" onclick="history.back(); return false;">Назад</a></li></ul></div></td></tr><tr class="row2"><td class="cell1"><div> </div></td><td class="cell2"><div> </div></td><td class="cell3"><div> </div></td><td class="cell4"><div id="courseTitle">Корпоративные информационные системы</div><div id="courseSubTitle">Языки запросов к базам данных : Практика 2. Использование подпрограмм в языках  программирования 4-го поколения</div></td></tr></table></td></tr><tr><td id="contentOuter"><table id="contentInner"><tr><td class="menuOuter"><table class="menuInner"><tr><td><ul class="level0"><li><a href="../../00/styles/courses.html">Содержание курса</a></li><li><span>Теория</span></li><ul class="level1"><li><a href="../../03/content/content1.html">Оптимизация запросов</a></li><li><a href="../../03/content/content2.html">Окружение 4-го поколения</a></li><li><a href="../../03/content/content3.html">Язык PL / SQL. Общие положения </a></li><li><a href="../../03/content/content4.html">Переменные и константы. Кодовое множество</a></li><li><a href="../../03/content/content5.html">Типы данных</a></li><li><a href="../../03/content/content6.html">Команды управления</a></li><li><a href="../../03/content/content7.html">Создание хранимых процедур и функций </a></li><li><a href="../../03/content/content8.html">Параметры подпрограмм</a></li><li><a href="../../03/content/content9.html">Встроенные функции PL / SQL</a></li><li><a href="../../03/content/content10.html">Курсоры</a></li><li><a href="../../03/content/content11.html">Исключительные ситуации</a></li><li><a href="../../03/content/content12.html">Обработчики исключений </a></li><li><a href="../../03/content/content13.html">Пакеты</a></li><li><a href="../../03/content/content14.html">Триггеры объектов </a></li></ul><li><span>Практика</span></li><ul class="level1"><li><a href="../../03/content/example1.html">Практика 2. Использование подпрограмм в языках  программирования 4-го поколения</a></li><li><a href="../../03/content/example2.html">Лабораторная работа 2 Подпрограммы как средство создания серверных частей информационных систем на примере СУБД Oracle </a></li><li><a href="../../03/content/example3.html">Практика 3. Создание  и работа с триггерами объектов и событий</a></li><li><a href="../../03/content/example4.html">Лабораторная работа 3. Триггеры объектов и событий базы данных </a></li></ul><li><span>Текущий контроль знаний</span></li><ul class="level1"><li><a href="../../03/content/multiply-choice-test25.html">Управляющие структуры</a></li><li><a href="../../03/content/multiply-answers-test7.html">Подпрограммы языка PL/SQL</a></li><li><a href="../../03/content/multiply-choice-test1.html">Курсоры</a></li><li><a href="../../03/content/multiply-answers-test12.html">Исключительные ситуации</a></li><li><a href="../../03/content/multiply-choice-test19.html">Пакеты</a></li><li><a href="../../03/content/multiply-answers-test3.html">Триггеры</a></li></ul><li><a href="../../03/styles/glossary.html">Словарь терминов</a></li><li><a href="../../03/03.pdf" target="_blank">Версия для печати</a></li></ul></td></tr></table></td><td class="content"><div id="content"><div id="topBlankStripe"> </div><span id="lnk67dff15dc73a49088462384139f71163"> </span><h1 align="left" class="headline-source">     Практика 2. Использование подпрограмм в языках  программирования 4-го поколения</h1><span id="lnke763e78e6c5a4bddad6c661ffe788656"> </span><h2 align="left" class="paragraph-headline-source">     Работа со встроенными фукнциями </h2><span id="lnkf90036d529244f7f93d123bdd8619b4e"> </span><table class="note"><tr><td><p align="left" class="note-source">     Данные поля name (таблицы Goods) перевести в верхний регистр. </p></td><th><img src="../../00/styles/files/note_problem.png" title="Проблемма" alt="Проблемма" /></th></tr></table><span id="lnk67ba200a507e41d0a162adf672e8561b"> </span><div class="section"><p align="left" class="paragraph-source">SELECT UPPER(NAME) FROM GOODS; </p></div><span id="lnk624b81b5431c4adab51aa391be5a9c5b"> </span><table class="note"><tr><td><p align="justify" class="note-source">     Для произвольной строки вывести подстроку прописными символами. Подстрока длиной LEN и начинается с позиции POS . </p></td><th><img src="../../00/styles/files/note_problem.png" title="Проблемма" alt="Проблемма" /></th></tr></table><span id="lnkdeb96e54d0c84d199841c60684b7caf5"> </span><div class="section"><p align="left" class="paragraph-source">CREATE OR REPLACE FUNCTION F2 <br />(STR IN VARCHAR2, POS NUMBER, LEN NUMBER) RETURN VARCHAR2 AS <br />STR_2 VARCHAR2 (20); <br />BEGIN <br />STR_2:=UPPER( SUBSTR (STR, POS, LEN)); <br />RETURN STR _ 2 ; <br />END ; </p></div><span id="lnkaeec8957d19c43418e49a9cb3f3a52cf"> </span><div class="section"><p align="left" class="paragraph-source">     Вызов функции F2 может быть такой:</p><p align="left" class="paragraph-source">SQL&gt; SELECT F2('qwertyu', 2, 4);</p></div><span id="lnkcd3215f024144349a3b4f9ca725a7704"> </span><table class="note"><tr><td><p align="justify" class="note-source">     Рассмотрим пример вызова в SQL*Plus встроенной функции преобразования типов данных ( TO _ CHAR ) </p></td><th><img src="../../00/styles/files/note_problem.png" title="Проблемма" alt="Проблемма" /></th></tr></table><span id="lnkdf29049700a44470a7f59b19a067f9f8"> </span><div class="section"><p align="left" class="paragraph-source">SQL&gt; SELECT TO_CHAR(SYSDATE, YEAR MONTH DAY DD') FROM DUAL; </p></div><span id="lnkbb1aa2eadce6438c8e55fd55ced974f8"> </span><div class="section"><p align="justify" class="paragraph-source">     Функция первый параметр получает с помощью другой встроенной функции SYSDATE , а затем полученное значение приводит к формату  YEAR MONTH DAY DD '. Таким образом, показанные вызов функции позволяет вернуть текущую дату в формате: год прописью, название месяца, название дня недели и число. </p></div><span id="lnk291e1402d4e74bdcad8e7aaec8fdd4ac"> </span><h2 align="left" class="paragraph-headline-source">     Создание пользовательских  функций</h2><span id="lnk9c9103eadeed42eb967f4a94d894c173"> </span><table class="note"><tr><td><p align="justify" class="note-source">     Написать функцию, которая возвращает значение определенной статистики по некоторому столбцу некоторой таблицы. Например, для таблицы Goods подсчитать количество строк со значением поля PRICE меньше среднего.</p></td><th><img src="../../00/styles/files/note_problem.png" title="Проблемма" alt="Проблемма" /></th></tr></table><span id="lnk1cf829f327f247db976b3277d6d08d4e"> </span><div class="section"><p align="justify" class="paragraph-source">CREATE OR REPLACE FUNCTION LESS_THAN_AVG RETURN INTEGER AS </p><p align="justify" class="paragraph-source">ROW_COUNT INTEGER;</p><p align="justify" class="paragraph-source">BEGIN</p><p align="justify" class="paragraph-source">SELECT COUNT(*) INTO ROW_COUNT FROM GOODS</p><p align="justify" class="paragraph-source">     WHERE PRICE &lt;</p><p align="justify" class="paragraph-source">(SELECT AVG(PRICE) FROM GOODS);</p><p align="justify" class="paragraph-source">RETURN ROW_COUNT;</p><p align="left" class="paragraph-source">END LESS_THAN_AVG;</p></div><span id="lnkeff8171a43b44c80929ebe444b2bc8e4"> </span><table class="note"><tr><td><p align="justify" class="note-source">     Определить функцию, которая получает в качестве параметра цену и возвращает количество записей в таблице Goods со значением поля PRICE меньше заданного. </p></td><th><img src="../../00/styles/files/note_problem.png" title="Проблемма" alt="Проблемма" /></th></tr></table><span id="lnk1a66998328094dc697800edc1f249f45"> </span><div class="section"><p align="justify" class="paragraph-source">CREATE OR REPLACE FUNCTION count_goods (new_price IN Goods.price%TYPE)</p><p align="justify" class="paragraph-source">RETURN INTEGER</p><p align="justify" class="paragraph-source">IS temp_count Goods.Quantity%TYPE;</p><p align="justify" class="paragraph-source">BEGIN </p><p align="justify" class="paragraph-source">SELECT COUNT(*) INTO temp_count FROM Goods </p><p align="justify" class="paragraph-source">       WHERE price &lt; new_price; </p><p align="justify" class="paragraph-source">RETURN(temp_count);</p><p align="left" class="paragraph-source">END count_goods;</p></div><span id="lnk631f6397068e45bf853a6ea382d916d0"> </span><h2 align="left" class="paragraph-headline-source">     Создание  и работа с сохраняемыми процедурами</h2><span id="lnk968a24a4cf274213af2f6f9a3c5efc14"> </span><table class="note"><tr><td><p align="justify" class="note-source">     Написать процедуру, которая добавляла бы новые отделы в таблицу Departments.</p></td><th><img src="../../00/styles/files/note_problem.png" title="Проблемма" alt="Проблемма" /></th></tr></table><span id="lnk3c0b4ef8bdd04fec848dc74857b5c041"> </span><div class="section"><p align="justify" class="paragraph-source">     Для этого понадобится последовательность, с помощью которой мы можем задавать первичный ключ таблицы (последовательность должна начинаться с номера, следующего за последним номером, который вы использовали для добавления отделов в таблицу).</p></div><span id="lnk45e2927f92e5410a8419e1c05a3add92"> </span><div class="section"><p align="left" class="paragraph-source">CREATE SEQUENCE dept_seq START WITH 4;</p></div><span id="lnke555fc689e914be98ce11ce61d257431"> </span><div class="section"><p align="justify" class="paragraph-source">CREATE PROCEDURE insert_dept (new_name VARCHAR2, new_info VARCHAR2 DEFAULT New department  ) AS </p><p align="justify" class="paragraph-source">BEGIN </p><p align="justify" class="paragraph-source">INSERT INTO Departments VALUES (dept_seq.NEXTVAL, new_name, new_info);</p><p align="justify" class="paragraph-source">END insert_dept; </p></div><span id="lnk560a87f90d55408f940e845e0d6222b8"> </span><div class="section"><p align="left" class="paragraph-source">     Вызов процедуры производится с помощью команды EXEC:</p><p align="justify" class="paragraph-source">EXEC insert_dept ('SWEETS');</p></div><span id="lnk372289aff7594a0d84efc814106a8dcf"> </span><table class="note"><tr><td><p align="justify" class="note-source">     Написать процедуру, которая для товара с заданным номером изменяет цену на заданную.При вызове этой процедуры использовать  позиционную и именную нотации</p></td><th><img src="../../00/styles/files/note_problem.png" title="Проблемма" alt="Проблемма" /></th></tr></table><span id="lnk1080d7d2f87c41ee934187de9a4a367c"> </span><div class="section"><p align="left" class="paragraph-source">CREATE PROCEDURE change _ price ( good _ id 1 NUMBER , price 1 NUMBER ) IS <br />BEGIN <br />UPDATE goods SET price = price1 WHERE good_id = good_id1; <br />END change _ price ; </p><p align="left" class="paragraph-source">      </p><p align="justify" class="paragraph-source">     При вызове подпрограммы можно записывать фактические параметры, используя позиционную или именную нотацию. Иными словами, можно указывать соответствие между фактическими и формальными параметрами через позиции этих параметров или через их имена. </p><p align="justify" class="paragraph-source">     Можно вызвать процедуру change _ price четырьмя логически эквивалентными способами: </p><p align="left" class="paragraph-source">DECLARE <br />change_goods NUMBER(4):=2; <br />new_price NUMBER(8,2):=10; <br />BEGIN <br />change_price(change_goods, new_price); -- позиционная нотация <br />change_price(change_goods=&gt; goods_id1, new_price=&gt; price1); -- именная нотация <br />change_price(new_price=&gt; price1, change_goods=&gt; goods_id1); -- именная нотация <br />change_price(change_goods, new_price=&gt; price1); -- смешанная нотация <br />END; </p></div><span id="lnk89d3da0afcf5474bb82a61f272cc17dd"> </span><table class="note"><tr><td><p align="justify" class="note-source">     Написать процедуру покупки товара - занесение данных в таблицу Sales и изменение количества товаров, имеющихся в наличии. В случае недостачи товара - покупку не фиксировать и выводить сообщение не «хватает Х единиц товара», где Х - недостающее количество.Для этого понадобится последовательность, с помощью которой задавать первичный ключ таблицы Sales</p></td><th><img src="../../00/styles/files/note_problem.png" title="Проблемма" alt="Проблемма" /></th></tr></table><span id="lnka048bdd11e3f424485b69f00887d1b6e"> </span><div class="section"><p align="left" class="paragraph-source">CREATE SEQUENCE Sales_seq START WITH 4;</p></div><span id="lnk28beff9334074613a3f8873282b844bb"> </span><div class="section"><p align="left" class="paragraph-source">CREATE OR REPLACE PROCEDURE ins_sale (new_check NUMBER, new_good_id NUMBER, new_date DATE DEFAULT SYSDATE, need_quantity INTEGER DEFAULT 1) AS</p><p align="left" class="paragraph-source">quantity1 INTEGER;</p><p align="left" class="paragraph-source">BEGIN </p><p align="left" class="paragraph-source">SELECT quantity INTO quantity1 FROM Goods WHERE good_id=new_good_id;</p><p align="left" class="paragraph-source">IF quantity1 &lt; need_quantity THEN </p><p align="left" class="paragraph-source">DBMS_OUTPUT.put_line ( Не хватает  || (need_quantity-quantity1) ||  единиц товара);</p><p align="left" class="paragraph-source">/* Для вывода на экран  используем процедуру put_line пакета вивода DBMS_OUTPUT */</p><p align="left" class="paragraph-source">ELSIF quantity1 = need_quantity THEN</p><p align="left" class="paragraph-source">     DELETE FROM Goods WHERE good_id=new_good_id;</p><p align="left" class="paragraph-source">     INSERT INTO Sales VALUES (Sales_seq.nextval, new_check, new_good_id, new_date, need_quantity);</p><p align="left" class="paragraph-source">     COMMIT;</p><p align="left" class="paragraph-source">     ELSE</p><p align="left" class="paragraph-source">UPDATE Goods SET quantity = quantity - need_quantity WHERE good_id=new_good_id;</p><p align="left" class="paragraph-source">INSERT INTO Sales VALUES (Sales_seq.nextval, new_check, new_good_id, new_date, need_quantity);</p><p align="left" class="paragraph-source">               COMMIT;</p><p align="left" class="paragraph-source">     END IF;</p><p align="justify" class="paragraph-source">END ins_sale</p></div><span id="lnkff1773d8d1f14957834cae16fe3997de"> </span><div class="section"><p align="justify" class="paragraph-source">     Для вывода информации с использованием стандартных функций необходимо включить режим вывода:</p><p align="justify" class="paragraph-source">SET SERVEROUT ON;</p><p align="justify" class="paragraph-source">     Следует обратить внимание на то, что при удалении информации о товаре, количество которого равно заданному (тому, что желает приобрести покупатель) может возникнуть ошибка выполнения программы, связанная с наличием порожденных записей в таблице Sales (предварительные операции покупки этого же товара). Необходимо переделать процедуру с учетом такой ситуации.</p></div><span id="lnkb1a2c8a42a8d4636899429606209fa19"> </span><h2 align="left" class="paragraph-headline-source">     Использование явных курсоров </h2><span id="lnk7dee1ca291234cdda9cfe252632e2c13"> </span><table class="note"><tr><td><p align="justify" class="note-source">     Необходимо сформировать таблицу-описание товаров, хранящихся во всех отделах, в виде показанном в  таблице 7.</p></td><th><img src="../../00/styles/files/note_problem.png" title="Проблемма" alt="Проблемма" /></th></tr></table><span id="lnke52373a7deec400c951eb026c6e1ffdb"> </span><div align="center"><div class="inline-table-container"><p align="left" class="unit-title">Таблица 7 - Вид результирующей таблицы</p><table class="inline-table"><col width="87" /><col width="160" /><col width="318" /><tbody><tr><td style="background-color:#ffffff"><p align="center" class="inline-table">Dept_id</p></td><td style="background-color:#ffffff"><p align="center" class="inline-table">Name</p></td><td style="background-color:#ffffff"><p align="center" class="inline-table">List_of_goods: goods/quantity/price;</p></td></tr><tr><td style="background-color:#ffffff"><p align="left" class="inline-table">1</p></td><td style="background-color:#ffffff"><p align="left" class="inline-table">VEGETABLES</p></td><td style="background-color:#ffffff"><p align="left" class="inline-table">APPLE/7.6/12; PINEAPPLE/14.99/9;</p></td></tr><tr><td style="background-color:#ffffff"><p align="left" class="inline-table">2</p></td><td style="background-color:#ffffff"><p align="left" class="inline-table">...</p></td><td style="background-color:#ffffff"><p align="left" class="inline-table">...</p></td></tr><tr><td style="background-color:#ffffff"> </td><td style="background-color:#ffffff"> </td><td style="background-color:#ffffff"> </td></tr></tbody></table></div></div><span id="lnk85c2961cd711405bb876b5ebf8150380"> </span><div class="section"><p align="justify" class="paragraph-source">     Для ведения данной таблицы понадобится последовательность:</p><p align="left" class="paragraph-source">CREATE SEQUENCE list_seq;</p></div><span id="lnkcb0e087592f946ea8c033d4199522188"> </span><div class="section"><p align="justify" class="paragraph-source">     Команда создания таблицы-описания приведена ниже: </p><p align="justify" class="paragraph-source">CREATE TABLE list_dept (</p><p align="justify" class="paragraph-source">Dept_id NUMBER(3) NOT NULL PRIMARY KEY,</p><p align="justify" class="paragraph-source">Name VARCHAR2(20),</p><p align="justify" class="paragraph-source">list_of_goods VARCHAR2(2000));</p></div><span id="lnk23145c8050e646dea0b1b8e731dba9dd"> </span><div class="section"><p align="justify" class="paragraph-source">     Приведем пример реализации этой процедуры с помощью явного описания курсоров и обращения к атрибутам явных курсоров:</p><p align="justify" class="paragraph-source">CREATE OR REPLACE PROCEDURE list_goods AS </p><p align="justify" class="paragraph-source">-- курсор для получения всего перечня отделов</p><p align="justify" class="paragraph-source">CURSOR list_dept IS </p><p align="justify" class="paragraph-source">SELECT dept_id, name FROM Departments; </p><p align="justify" class="paragraph-source">/* курсор для получения информации о товарах, находящихся в заданном отделе */</p><p align="justify" class="paragraph-source">CURSOR l_goods (dept_n1 NUMBER) IS </p><p align="justify" class="paragraph-source">SELECT Name, Price, Quantity FROM Goods</p><p align="justify" class="paragraph-source">WHERE Dept_id=dept_n1; </p></div><span id="lnk3757e90c3fa240d6a3532f95ccb34384"> </span><div class="section"><p align="justify" class="paragraph-source">Dept_id1 Departments.Dept_id%Type; </p><p align="justify" class="paragraph-source">Name1 Departments.Name%Type; </p><p align="justify" class="paragraph-source">Name_G Goods.Name%Type; </p><p align="justify" class="paragraph-source">Quantity1 Goods.Quantity%Type; </p><p align="justify" class="paragraph-source">Price1 Goods.Price%Type; </p><p align="justify" class="paragraph-source">list_goods VARCHAR2(200) := ''; </p><p align="justify" class="paragraph-source">BEGIN </p><p align="justify" class="paragraph-source">DELETE FROM list_dept; </p><p align="justify" class="paragraph-source">IF List_dept%isopen THEN Close List_dept;</p><p align="justify" class="paragraph-source">End if;</p><p align="justify" class="paragraph-source">OPEN list_dept; </p><p align="justify" class="paragraph-source">LOOP </p><p align="justify" class="paragraph-source">FETCH list_dept INTO Dept_id1, Name1;</p><p align="justify" class="paragraph-source">EXIT WHEN list_dept%NOTFOUND; </p><p align="justify" class="paragraph-source">OPEN l_goods(Dept_id1); </p><p align="justify" class="paragraph-source">list_goods:='';</p><p align="justify" class="paragraph-source">LOOP </p><p align="justify" class="paragraph-source">FETCH l_goods INTO Name_G, Price1, Quantity1; </p><p align="justify" class="paragraph-source">EXIT WHEN l_goods%NOTFOUND; </p><p align="justify" class="paragraph-source">list_goods:= list_goods|| Name_G||'/'|| Price1 || '/'|| Quantity1 || '; '; </p><p align="justify" class="paragraph-source">END LOOP;</p><p align="justify" class="paragraph-source">CLOSE l_goods; </p><p align="justify" class="paragraph-source">INSERT INTO list_dept VALUES (Dept_id1, Name1, list_goods);</p><p align="justify" class="paragraph-source">END LOOP;</p><p align="justify" class="paragraph-source">CLOSE list_Dept; </p><p align="justify" class="paragraph-source">COMMIT; </p><p align="justify" class="paragraph-source">END;</p><p align="justify" class="paragraph-source">     Вызов и результат выполнения процедуры приведены на рис. 13</p></div><span id="lnkd3b16e5de8504137a85bca3daaaecfbe"> </span><div class="section"><p align="center" class="paragraph-source"><img src="../res/files/jpg4d3_0_.jpg" height="284px" width="650px" alt="" /> </p><p align="center" class="paragraph-source">     Рисунок 13 - Вызов и результат работы процедуры</p></div><span id="lnk331922b674784cf2947f39f68cef8f6d"> </span><table class="note"><tr><td><p align="justify" class="note-source">     Самостоятельно разработайте процедуру заполнения аналогичной таблицы с использованием курсорных циклов.</p></td><th><img src="../../00/styles/files/note_problem.png" title="Проблемма" alt="Проблемма" /></th></tr></table><span id="lnk759eb3d2692c4b368890734d18efe6fa"> </span><h2 align="left" class="paragraph-headline-source">     Обработка исключений</h2><span id="lnk21e50c8df83340a2858814c1128ccdc7"> </span><table class="note"><tr><td><p align="justify" class="note-source">     Разработайте процедуру снижения цены на заданные товары на заданную сумму. Следует предусмотреть  такие  исключительные  ситуации: </p><p align="justify" class="note-source">     - если количество товара не превышает 10, а новая цена составляет мене  чем 50% от старой цены,  то ошибка  «Большая скидка»;</p><p align="justify" class="note-source">     - если количество товара более 100,  а новая стоимость составляет более чем 90% от старой цены,  то ошибка  «Маленькая  скидка»;</p><p align="justify" class="note-source">     -если не найдено такого товара,  необходимо вывести предупреждение: «Такого товара не существует».</p></td><th><img src="../../00/styles/files/note_problem.png" title="Проблемма" alt="Проблемма" /></th></tr></table><span id="lnkc4d992f9832a4c4b8b7bf0e240f90f25"> </span><div class="section"><p align="justify" class="paragraph-source">CREATE OR REPLACE PROCEDURE Discount (G_name VARCHAR2, Price1 NUMBER) AS</p><p align="justify" class="paragraph-source">Good_Id1 Goods.Good_id%type;</p><p align="justify" class="paragraph-source">Price_g Goods.Price%type;</p><p align="justify" class="paragraph-source">Quantity_g Goods.Quantity%type;</p><p align="justify" class="paragraph-source">Low_disc EXCEPTION;</p><p align="justify" class="paragraph-source">Big_disc EXCEPTION;</p><p align="justify" class="paragraph-source">BEGIN</p><p align="justify" class="paragraph-source">SELECT Good_id, Price, Quantity INTO Good_id1, Price_g, Quantity_g </p><p align="justify" class="paragraph-source">FROM Goods</p><p align="justify" class="paragraph-source">WHERE Upper(Name) like '%'||Upper(G_name)||'%' AND ROWNUM=1;</p><p align="justify" class="paragraph-source">IF ((Price_G*0.5)&gt;(price_g-price1) and Quantity_g&lt;10) THEN RAISE Big_Disc;</p><p align="justify" class="paragraph-source">ELSIF (Price_G*0.9&lt;(price_g-price1) and Quantity_g&gt;100) THEN RAISE Low_Disc;</p><p align="justify" class="paragraph-source">END IF;</p><p align="justify" class="paragraph-source">UPDATE Goods SET Price=Price-Price1 WHERE Good_id=Good_id1;</p><p align="justify" class="paragraph-source">Commit;</p><p align="justify" class="paragraph-source">EXCEPTION</p><p align="justify" class="paragraph-source">WHEN Low_disc THEN</p><p align="justify" class="paragraph-source">     Raise_application_error (-20002, 'Low discount');</p><p align="justify" class="paragraph-source">WHEN Big_disc THEN</p><p align="justify" class="paragraph-source">     Raise_application_error (-20003, 'Big discount');</p><p align="justify" class="paragraph-source">WHEN NO_DATA_FOUND THEN</p><p align="justify" class="paragraph-source">     Raise_application_error (-20001, 'No such good');</p><p align="justify" class="paragraph-source">END;</p><p align="justify" class="paragraph-source">/</p></div><span id="lnka501adcb489c4853bea6e9169df67d32"> </span><h2 align="left" class="paragraph-headline-source">     Задачи для самостоятельного выполнения</h2><span id="lnk3c8a2c29be124f569b2d42b2a51256df"> </span><table class="note"><tr><td><p align="justify" class="note-source">     Разработайте функцию обработки данных из таблиц. Примеры заданий:</p><p align="justify" class="note-source">     <!--[if !IE]>-->−<!--<![endif]--><!--[if IE]><span style="font-family:symbol, arial, helvetica, serif;" >-</span><![endif]-->разработайте функцию, которая по названию отдела (входной параметр) возвращает суммарную стоимость товаров этого отдела;</p><p align="justify" class="note-source">     <!--[if !IE]>-->− <!--<![endif]--><!--[if IE]><span style="font-family:symbol, arial, helvetica, serif;" >- </span><![endif]-->разработайте функцию, которая по названию отдела (входной параметр) возвращает наименование товара, количество которого является максимальной;</p><p align="justify" class="note-source">     <!--[if !IE]>-->−<!--<![endif]--><!--[if IE]><span style="font-family:symbol, arial, helvetica, serif;" >-</span><![endif]-->разработайте функцию, которая по названию изготовителя (входной параметр) возвращает наименование его дешевого товара (любого).</p></td><th><img src="../../00/styles/files/note_problem.png" title="Проблемма" alt="Проблемма" /></th></tr></table><span id="lnk76903f2d906a45fc830d53698804d958"> </span><table class="note"><tr><td><p align="justify" class="note-source">     Разработайте процедуру, которая выполняет действия модифицирования данных таблиц, созданных в предыдущей лабораторной работе. Примеры заданий:</p><p align="justify" class="note-source">     <!--[if !IE]>-->−<!--<![endif]--><!--[if IE]><span style="font-family:symbol, arial, helvetica, serif;" >-</span><![endif]-->для товаров из заданного отдела, которые дороже заданной цены, в поле Description написать «Дорогой товар», а для остальных  его  товаров- «Дешевый товар»;</p><p align="justify" class="note-source">     <!--[if !IE]>-->− <!--<![endif]--><!--[if IE]><span style="font-family:symbol, arial, helvetica, serif;" >- </span><![endif]-->провести снижение цены товаров,  которые находятся в заданном отделе на заданное  число  процентов;</p><p align="justify" class="note-source">     <!--[if !IE]>-->−<!--<![endif]--><!--[if IE]><span style="font-family:symbol, arial, helvetica, serif;" >-</span><![endif]--> для заданного отдела в поле Info записать текущую  дату.</p></td><th><img src="../../00/styles/files/note_problem.png" title="Проблемма" alt="Проблемма" /></th></tr></table><span id="lnk44cf9472aaa24459832609128d9539f9"> </span><table class="note"><tr><td><p align="justify" class="note-source">     Разработайте функцию формирования выходной строки через  запятую. Примеры заданий:</p><p align="justify" class="note-source">     <!--[if !IE]>-->−<!--<![endif]--><!--[if IE]><span style="font-family:symbol, arial, helvetica, serif;" >-</span><![endif]-->входной параметр - название отдела, результат -  список наименований товаров, которые находятся в заданном отделе;</p><p align="justify" class="note-source">     <!--[if !IE]>-->− <!--<![endif]--><!--[if IE]><span style="font-family:symbol, arial, helvetica, serif;" >- </span><![endif]-->входные параметры - диапазон цен (m і n), результат - список товаров с ценой в заданном диапазоне;</p><p align="justify" class="note-source">     <!--[if !IE]>-->− <!--<![endif]--><!--[if IE]><span style="font-family:symbol, arial, helvetica, serif;" >- </span><![endif]-->список номеров чеков, по которым было приобретено товаров на сумму меньше заданной как входной параметр.</p></td><th><img src="../../00/styles/files/note_problem.png" title="Проблемма" alt="Проблемма" /></th></tr></table><span id="lnk2a000765c0c043bdb06f659b752b3667"> </span><table class="note"><tr><td><p align="justify" class="note-source">     Разработайте процедуру с использованием курсоров . Примеры заданий:</p><p align="justify" class="note-source">     <!--[if !IE]>-->− <!--<![endif]--><!--[if IE]><span style="font-family:symbol, arial, helvetica, serif;" >- </span><![endif]-->процедура закупки - заполнить таблицу закупки (поля: производитель,  название товара,  цена,  размер закупки) такими данными: если price&gt;1000, то нужно 10 единиц товара, если  500&lt;price&lt;1000, то нужно 20 единиц, если price&lt;500, то - 30 единиц;</p><p align="justify" class="note-source">     <!--[if !IE]>-->− <!--<![endif]--><!--[if IE]><span style="font-family:symbol, arial, helvetica, serif;" >- </span><![endif]-->выбрать и записать в таблицу по два самых дешевых товара отдела (поля: производитель, товар,  цена);</p><p align="justify" class="note-source">     <!--[if !IE]>-->−<!--<![endif]--><!--[if IE]><span style="font-family:symbol, arial, helvetica, serif;" >-</span><![endif]--> процедура разбиения товара на ценовые группы (входной параметр - количество  групп). Сформировать таблицу с такими полями: номер группы,  минимальная цена  в группе,  максимальная цена  в группе,  список товаров группы через запятую.</p></td><th><img src="../../00/styles/files/note_problem.png" title="Проблемма" alt="Проблемма" /></th></tr></table><span id="lnkfbe2099c01d844c592392d3aad1fa569"> </span><div class="section"><p align="left" class="paragraph-source">     Далее следует выполнить <a title="" target="_self" href="../../03/content/example2.html#lnk1b4ec536f7354bae95b30e6d2cbed639">лабораторную работу 2</a></p></div></div></td></tr></table></td></tr><tr><td id="bottomOuter"><table id="bottomInner"><tr><td class="cell1"><div> </div></td><td class="cell2"><div>© 2012 ХНУРЭ, ПИ, Широкопетлева М.С., <a href="mailto:mshirokopetleva@gmail.com">mshirokopetleva@gmail.com</a>;   ХНУРЭ, ПИ, Черепанова Ю.Ю.;   ХНУРЭ, ПИ, Мазурова О.А.<br /><a href="http://lersus.de/" title="Данный курс создан с помощью авторской системы LERSUS" target="_blank">Разработано с помощью LERSUS</a></div></td></tr></table></td></tr></table></body></html>